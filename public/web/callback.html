<!DOCTYPE html>
<html lang="en">
<head>
</head>
<body>
<script>
    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");
    const state = params.get("state");

    if (code && state) {
        fetch("{{.iam_callback}}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ code, state }),
        })
            .then((res) => res.json())
            .then((data) => {
                if (data.error) {
                    console.error(data.error);
                } else {
                    localStorage.setItem("token", data.token);
                    window.location.href = "/";
                }
            });
    }
</script>
</body>
</html>
